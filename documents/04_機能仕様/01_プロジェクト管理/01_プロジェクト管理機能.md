# プロジェクト管理機能仕様

## 概要

プロジェクト管理機能は、LLM学術文書支援システムのコア機能の一つであり、ユーザーが学術文書を体系的に整理し、効率的に学習・研究を進めるための基盤となります。プロジェクトとは、特定のテーマや課題に関連する文書、ノート、およびLLMとの対話履歴をまとめた論理的な単位です。

## 目的

- 関連する学術文書を論理的にグループ化する
- 複数のユーザーによる共同研究・学習を支援する
- 学術研究のワークフローを効率化する
- 研究の進捗状況を可視化する

## 機能詳細

### 1. プロジェクト基本操作

#### 1.1 プロジェクト作成

| 項目 | 説明 |
|------|------|
| 機能ID | PM-001 |
| 機能名 | プロジェクト作成 |
| 説明 | 新規プロジェクトを作成する |
| 入力情報 | - プロジェクト名（必須、1〜100文字）<br>- 説明（任意、0〜500文字）<br>- 公開設定（公開/非公開） |
| 処理内容 | 1. ユーザー入力の検証<br>2. プロジェクトIDの生成<br>3. DBへのプロジェクト情報保存<br>4. 現在のユーザーをオーナーとして設定 |
| 出力情報 | 作成されたプロジェクト情報（ID、名前、説明、作成日時など） |
| 画面遷移 | 作成後は新規プロジェクトの詳細画面に遷移 |
| エラー処理 | - 必須項目の未入力：エラーメッセージ表示<br>- 文字数超過：エラーメッセージ表示 |

#### 1.2 プロジェクト編集

| 項目 | 説明 |
|------|------|
| 機能ID | PM-002 |
| 機能名 | プロジェクト編集 |
| 説明 | 既存プロジェクトの情報を編集する |
| 入力情報 | - プロジェクトID（パスから自動取得）<br>- プロジェクト名（必須、1〜100文字）<br>- 説明（任意、0〜500文字）<br>- 公開設定（公開/非公開） |
| 処理内容 | 1. ユーザー入力の検証<br>2. 権限チェック（オーナーまたは編集権限を持つメンバーのみ可能）<br>3. DBのプロジェクト情報更新<br>4. 更新履歴の記録 |
| 出力情報 | 更新されたプロジェクト情報 |
| 画面遷移 | 編集後はプロジェクト詳細画面に戻る |
| エラー処理 | - 権限エラー：アクセス拒否メッセージ<br>- 入力検証エラー：エラーメッセージ表示 |

#### 1.3 プロジェクト削除

| 項目 | 説明 |
|------|------|
| 機能ID | PM-003 |
| 機能名 | プロジェクト削除 |
| 説明 | 既存プロジェクトを削除する |
| 入力情報 | - プロジェクトID（パスから自動取得）<br>- 削除確認（チェックボックスまたは確認テキスト入力） |
| 処理内容 | 1. 権限チェック（オーナーのみ可能）<br>2. 関連リソース（文書、ノート、チャット履歴など）の確認<br>3. 論理削除処理（DBでの削除フラグ設定）<br>4. 関連リソースの論理削除処理 |
| 出力情報 | 削除完了通知 |
| 画面遷移 | 削除後はプロジェクト一覧画面に遷移 |
| エラー処理 | - 権限エラー：アクセス拒否メッセージ<br>- 確認未入力：エラーメッセージ表示 |

### 2. プロジェクトダッシュボード

#### 2.1 プロジェクト概要表示

| 項目 | 説明 |
|------|------|
| 機能ID | PM-004 |
| 機能名 | プロジェクト概要表示 |
| 説明 | プロジェクトの概要情報とメトリクスを表示する |
| 入力情報 | プロジェクトID（パスから自動取得） |
| 処理内容 | 1. プロジェクト基本情報の取得<br>2. 関連メトリクス（文書数、ノート数、メンバー数など）の集計<br>3. 最近のアクティビティ取得 |
| 出力情報 | - プロジェクト基本情報（名前、説明、作成日、オーナー）<br>- メトリクスサマリー<br>- 最近のアクティビティリスト |
| 画面構成 | - ヘッダー：プロジェクト名と操作ボタン<br>- メトリクスカード：主要統計情報<br>- アクティビティフィード：最近の更新 |
| 特記事項 | ダッシュボードはプロジェクトのランディングページとして機能 |

#### 2.2 プロジェクト統計

| 項目 | 説明 |
|------|------|
| 機能ID | PM-005 |
| 機能名 | プロジェクト統計 |
| 説明 | プロジェクトに関する詳細な統計情報を表示する |
| 入力情報 | - プロジェクトID（パスから自動取得）<br>- 期間指定（任意、デフォルトは全期間） |
| 処理内容 | 1. 指定期間のアクティビティデータ集計<br>2. 文書処理状況の集計<br>3. ユーザー別貢献度の計算 |
| 出力情報 | - 時系列アクティビティチャート<br>- 文書カテゴリ別分布<br>- メンバー別貢献度グラフ |
| 画面構成 | - 期間フィルター<br>- グラフ・チャートセクション<br>- サマリーテーブル |
| 特記事項 | 統計情報は CSV/PDF 形式でエクスポート可能 |

### 3. メンバー管理

#### 3.1 メンバー招待

| 項目 | 説明 |
|------|------|
| 機能ID | PM-006 |
| 機能名 | メンバー招待 |
| 説明 | プロジェクトに新しいメンバーを招待する |
| 入力情報 | - 招待者のメールアドレス（必須）<br>- 権限レベル（閲覧者/編集者/管理者）<br>- 招待メッセージ（任意） |
| 処理内容 | 1. メールアドレスの検証<br>2. 既存ユーザーの確認<br>3. 招待レコードの作成<br>4. 招待メールの送信 |
| 出力情報 | 招待完了通知 |
| 画面構成 | - メンバー招待フォーム<br>- 招待中メンバーリスト |
| 特記事項 | 既存ユーザーの場合は即時承認可能、新規ユーザーの場合はアカウント登録フローを含む |

#### 3.2 メンバー権限管理

| 項目 | 説明 |
|------|------|
| 機能ID | PM-007 |
| 機能名 | メンバー権限管理 |
| 説明 | プロジェクトメンバーの権限を設定・変更する |
| 入力情報 | - メンバーID（選択）<br>- 権限レベル（閲覧者/編集者/管理者） |
| 処理内容 | 1. 権限チェック（オーナーまたは管理者のみ可能）<br>2. メンバーの権限更新<br>3. 変更履歴の記録 |
| 出力情報 | 権限更新完了通知 |
| 画面構成 | - メンバーリスト<br>- 各メンバーの権限設定ドロップダウン |
| エラー処理 | - 権限エラー：アクセス拒否メッセージ<br>- オーナーの権限変更不可：エラーメッセージ表示 |

#### 3.3 メンバー削除

| 項目 | 説明 |
|------|------|
| 機能ID | PM-008 |
| 機能名 | メンバー削除 |
| 説明 | プロジェクトからメンバーを削除する |
| 入力情報 | - メンバーID（選択）<br>- 削除確認 |
| 処理内容 | 1. 権限チェック（オーナーまたは管理者のみ可能）<br>2. オーナーでないことの確認<br>3. メンバーシップレコードの削除<br>4. 変更履歴の記録 |
| 出力情報 | メンバー削除完了通知 |
| 画面構成 | - メンバーリスト<br>- 各メンバーの削除ボタン<br>- 確認ダイアログ |
| エラー処理 | - 権限エラー：アクセス拒否メッセージ<br>- オーナー削除不可：エラーメッセージ表示 |

### 4. プロジェクト設定

#### 4.1 プロジェクトテンプレート設定

| 項目 | 説明 |
|------|------|
| 機能ID | PM-009 |
| 機能名 | プロジェクトテンプレート設定 |
| 説明 | プロジェクト固有のテンプレートを設定する |
| 入力情報 | - テンプレートタイプ（ノート/プロンプト/分析レポート）<br>- テンプレート内容<br>- デフォルト設定（有効/無効） |
| 処理内容 | 1. テンプレート内容の検証<br>2. DBへのテンプレート情報保存<br>3. 既存テンプレートの更新（該当する場合） |
| 出力情報 | テンプレート保存完了通知 |
| 画面構成 | - テンプレートタイプ選択<br>- マークダウンエディタ<br>- 設定オプション |
| 特記事項 | システムデフォルトテンプレートからのインポートも可能 |

#### 4.2 タグ・カテゴリ管理

| 項目 | 説明 |
|------|------|
| 機能ID | PM-010 |
| 機能名 | タグ・カテゴリ管理 |
| 説明 | プロジェクト内で使用するタグやカテゴリを管理する |
| 入力情報 | - タグ/カテゴリ名<br>- 説明（任意）<br>- 色（カテゴリのみ） |
| 処理内容 | 1. 名前の重複チェック<br>2. DBへの保存<br>3. 既存リソースへの適用（オプション） |
| 出力情報 | 保存完了通知 |
| 画面構成 | - タグ/カテゴリリスト<br>- 追加/編集フォーム<br>- 色選択パレット（カテゴリ用） |
| 特記事項 | タグは自由形式、カテゴリは階層構造を持たせることが可能 |

#### 4.3 プロンプトテンプレート管理

| 項目 | 説明 |
|------|------|
| 機能ID | PM-011 |
| 機能名 | プロンプトテンプレート管理 |
| 説明 | LLMプロンプトのテンプレートを管理する |
| 入力情報 | - テンプレート名<br>- プロンプト内容<br>- 適用対象（文書分析/要約/質問応答/説明生成） |
| 処理内容 | 1. テンプレート内容の検証<br>2. DBへの保存<br>3. モデルパラメータ設定（オプション） |
| 出力情報 | 保存完了通知 |
| 画面構成 | - テンプレートリスト<br>- エディタ<br>- パラメータ設定パネル |
| 特記事項 | 変数プレースホルダー（{title}, {content}など）をサポート |

### 5. プロジェクト共有・エクスポート

#### 5.1 プロジェクト公開設定

| 項目 | 説明 |
|------|------|
| 機能ID | PM-012 |
| 機能名 | プロジェクト公開設定 |
| 説明 | プロジェクトの公開範囲を設定する |
| 入力情報 | - 公開レベル（非公開/組織内公開/完全公開）<br>- 公開コンテンツ設定（サマリーのみ/全ドキュメント/選択ドキュメント） |
| 処理内容 | 1. 権限チェック（オーナーのみ可能）<br>2. 公開設定の更新<br>3. 公開URL生成（公開設定の場合） |
| 出力情報 | 設定更新完了通知 |
| 画面構成 | - 公開レベル選択<br>- 公開コンテンツ設定<br>- 公開URL表示（該当する場合） |
| エラー処理 | - 権限エラー：アクセス拒否メッセージ |

#### 5.2 プロジェクトエクスポート

| 項目 | 説明 |
|------|------|
| 機能ID | PM-013 |
| 機能名 | プロジェクトエクスポート |
| 説明 | プロジェクトデータをエクスポートする |
| 入力情報 | - エクスポート形式（ZIP/PDF/Markdown）<br>- エクスポート対象（全コンテンツ/選択コンテンツ）<br>- メタデータ含有オプション |
| 処理内容 | 1. 権限チェック（メンバーのみ可能）<br>2. 対象コンテンツの収集<br>3. 指定形式への変換<br>4. ダウンロードファイルの生成 |
| 出力情報 | エクスポートファイルのダウンロードリンク |
| 画面構成 | - エクスポート設定フォーム<br>- 進行状況表示<br>- ダウンロードボタン |
| 特記事項 | 大規模プロジェクトの場合は非同期処理とし、完了時に通知 |

#### 5.3 プロジェクト複製

| 項目 | 説明 |
|------|------|
| 機能ID | PM-014 |
| 機能名 | プロジェクト複製 |
| 説明 | 既存プロジェクトを複製して新規プロジェクトを作成する |
| 入力情報 | - 元プロジェクトID<br>- 新プロジェクト名<br>- 複製対象（構造のみ/文書含む/ノート含む/全コンテンツ） |
| 処理内容 | 1. 権限チェック（閲覧権限以上が必要）<br>2. 新プロジェクトの作成<br>3. 選択されたコンテンツの複製<br>4. 関連リソースのリンク更新 |
| 出力情報 | 複製完了通知と新プロジェクトへのリンク |
| 画面構成 | - 複製設定フォーム<br>- 進行状況表示 |
| 特記事項 | メンバーは複製されない（作成者が唯一のオーナーとなる） |

## UI設計

### プロジェクト一覧画面

プロジェクト一覧画面では、ユーザーがアクセスできるすべてのプロジェクトをリスト表示します。

![プロジェクト一覧画面](../../../images/project_list.png)

#### 主要コンポーネント
- ヘッダー: 新規プロジェクト作成ボタン、検索ボックス
- プロジェクトカード: 各プロジェクトの概要表示
  - プロジェクト名
  - 説明（一部）
  - メトリクス（文書数、メンバー数）
  - 最終更新日時
  - アクションメニュー（編集、削除、複製など）
- フィルター: オーナー、参加者、公開設定などでフィルタリング
- ソートオプション: 作成日、更新日、名前でソート

### プロジェクト詳細画面

プロジェクト詳細画面は、選択したプロジェクトの概要と関連コンテンツを表示するダッシュボードです。

![プロジェクト詳細画面](../../../images/project_dashboard.png)

#### 主要コンポーネント
- プロジェクトヘッダー: プロジェクト名、説明、アクションボタン
- メトリクスカード: 主要統計情報の視覚化
- 最近のアクティビティ: タイムライン形式での更新履歴
- コンテンツタブ:
  - 文書: プロジェクト内の文書一覧
  - ノート: 作成された学習ノート一覧
  - チャット: LLMとの対話履歴
  - メンバー: プロジェクト参加者一覧
  - 設定: プロジェクト設定

## データモデル

### プロジェクトモデル

```json
{
  "_id": "ObjectId",
  "name": "String",
  "description": "String",
  "ownerId": "ObjectId(User)",
  "isPublic": "Boolean",
  "publicAccessLevel": "String (enum: none, summary, full)",
  "publicUrl": "String",
  "createdAt": "Date",
  "updatedAt": "Date",
  "isDeleted": "Boolean",
  "metadata": {
    "tags": ["String"],
    "category": "String",
    "customFields": {}
  }
}
```

### プロジェクトメンバーシップモデル

```json
{
  "_id": "ObjectId",
  "projectId": "ObjectId(Project)",
  "userId": "ObjectId(User)",
  "role": "String (enum: owner, admin, editor, viewer)",
  "joinedAt": "Date",
  "invitedBy": "ObjectId(User)",
  "status": "String (enum: active, invited, declined)",
  "lastActivityAt": "Date"
}
```

### プロジェクトテンプレートモデル

```json
{
  "_id": "ObjectId",
  "projectId": "ObjectId(Project)",
  "type": "String (enum: note, prompt, report)",
  "name": "String",
  "content": "String",
  "isDefault": "Boolean",
  "createdBy": "ObjectId(User)",
  "createdAt": "Date",
  "updatedAt": "Date"
}
```

## APIインターフェース

### プロジェクト基本操作

#### プロジェクト作成 API

```
POST /api/projects
```

リクエスト:
```json
{
  "name": "量子力学基礎研究",
  "description": "量子力学の基礎概念と応用に関する研究プロジェクト",
  "isPublic": false
}
```

レスポンス:
```json
{
  "success": true,
  "data": {
    "id": "60a1c2e3d4e5f6a7b8c9d0e1",
    "name": "量子力学基礎研究",
    "description": "量子力学の基礎概念と応用に関する研究プロジェクト",
    "isPublic": false,
    "createdAt": "2023-12-01T12:00:00Z",
    "ownerId": "50a2b3c4d5e6f7g8h9i0j1k2"
  }
}
```

#### プロジェクト編集 API

```
PUT /api/projects/{projectId}
```

#### プロジェクト削除 API

```
DELETE /api/projects/{projectId}
```

### メンバー管理 API

#### メンバー招待 API

```
POST /api/projects/{projectId}/invitations
```

#### メンバー権限更新 API

```
PUT /api/projects/{projectId}/members/{userId}
```

#### メンバー削除 API

```
DELETE /api/projects/{projectId}/members/{userId}
```

## 実装上の注意点

1. **権限管理**:
   - 各機能の実行前に必ず権限チェックを行う
   - フロントエンドの表示/非表示だけでなく、バックエンドでも権限チェックを徹底する

2. **パフォーマンス**:
   - プロジェクト一覧表示時には必要な情報のみを取得し、詳細情報は遅延ロードする
   - 大量の文書を含むプロジェクトの場合、ページング処理を適切に実装する

3. **削除処理**:
   - 物理削除ではなく論理削除を基本とし、データの復旧可能性を確保する
   - 関連リソースの整合性を保つため、トランザクション的な処理を実装する

4. **監査ログ**:
   - 重要な操作（作成、編集、削除、権限変更など）は監査ログに記録する
   - 監査ログには操作者、操作日時、操作内容を含める

## 将来拡張予定の機能

- **プロジェクトタグ付け**: プロジェクトの分類や検索を容易にするタグ機能
- **プロジェクトアーカイブ**: 完了したプロジェクトをアーカイブする機能
- **テンプレートライブラリ**: 共有可能なプロジェクトテンプレートライブラリ
- **活動分析ダッシュボード**: プロジェクト活動の詳細な分析と可視化
- **外部連携**: Zotero、Mendeley、GitHubなどの外部サービスとの連携
