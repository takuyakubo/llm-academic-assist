# 全文検索機能仕様

## 1. 機能概要

全文検索機能は、システム内のドキュメント、ノート、チャット履歴など、すべてのテキストコンテンツを対象とした検索機能です。キーワードの一致に基づいた検索を提供し、高速かつ正確な検索結果を返します。

## 2. 検索対象

- **ドキュメント**: PDFから抽出したテキスト、構造化された章・節・小節
- **ノート**: ユーザーが作成・編集した学習ノート
- **チャット履歴**: LLMとの対話履歴
- **メタデータ**: タイトル、タグ、説明文など
- **数式**: LaTeXで記述された数式（テキスト化して検索）

## 3. 検索オプション

### 3.1 一致タイプ
- **部分一致**: キーワードを含むすべてのコンテンツ（デフォルト）
- **完全一致**: 指定したフレーズと完全に一致するコンテンツ
- **前方一致/後方一致**: 指定した接頭辞/接尾辞で始まる/終わる単語
- **正規表現**: 高度なパターンマッチング

### 3.2 検索対象の絞り込み
- **プロジェクト単位**: 特定のプロジェクト内のみ検索
- **ドキュメント単位**: 特定のドキュメント内のみ検索
- **コンテンツタイプ**: ドキュメント/ノート/チャット履歴から選択
- **日付範囲**: 作成日や更新日に基づく絞り込み

### 3.3 ソートオプション
- **関連度順**: 検索クエリとの関連性によるランキング（デフォルト）
- **日付順**: 作成日または更新日の新しい順/古い順
- **アルファベット順**: タイトルのアルファベット順

## 4. 検索結果の表示

### 4.1 結果リスト
- タイトル、コンテンツタイプ、一致箇所のスニペット表示
- 検索キーワードのハイライト表示
- コンテンツタイプごとのアイコン表示
- ページネーション（デフォルトは10件/ページ）

### 4.2 プレビュー
- 検索結果項目のホバー時にプレビュー表示
- 一致箇所の前後のコンテキストを含む
- 複数の一致がある場合は最も関連度の高い部分を表示

### 4.3 フィルター
- 検索結果に対する動的フィルターオプション
- タグ、作成者、日付範囲などによるフィルタリング
- ファセット検索（検索結果の統計情報を表示し、絞り込みに利用）

## 5. インデックス更新

- **リアルタイム更新**: 新規コンテンツや変更は即時インデックス登録
- **バックグラウンド処理**: 大量更新時はバックグラウンドでインデックス最適化
- **手動再インデックス**: 管理者による全インデックスの再構築オプション

## 6. パフォーマンス要件

- 検索クエリ応答時間: 基本検索で500ms以内
- 複雑な検索（複数条件、正規表現など）: 2秒以内
- インデックスサイズ: 原文書サイズの約20-30%

## 7. 利用技術

- **検索エンジン**: Elasticsearch 7.x以上
- **全文インデックス**: Inverted Index、BM25アルゴリズム
- **形態素解析**: 日本語テキスト用にMeCab/Kuromoji
- **ハイライト処理**: Elasticsearch Highlighterモジュール

## 8. APIエンドポイント

主要なAPIエンドポイントは[検索API仕様書](../../05_API仕様/04_APIリファレンス詳細/05_検索API.md)を参照してください。

## 9. 関連機能

- [意味検索](./03_意味検索.md)（ベクトル検索）
- [検索UI](../../03_システム設計/02_フロントエンド/04_検索コンポーネント.md)
