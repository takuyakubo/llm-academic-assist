# 意味検索機能仕様

## 1. 機能概要

意味検索（セマンティック検索）は、キーワードの一致ではなく、テキストの意味や概念に基づいて関連するコンテンツを検索する機能です。ベクトル埋め込みと機械学習モデルを活用し、ユーザーの意図に沿った検索結果を提供します。

## 2. 機能の特徴

- **意味的な類似性**: 同義語や関連概念を含むコンテンツも検索可能
- **自然言語クエリ**: 質問文や長い文章でも検索可能
- **文脈理解**: 文脈や意図を考慮した検索結果のランキング
- **多言語対応**: 言語間の意味的な対応関係も理解

## 3. ベクトル埋め込み

### 3.1 埋め込みモデル
- **テキスト埋め込み**: OpenAI text-embedding-ada-002 または 同等の埋め込みモデル
- **数式埋め込み**: 数式専用の埋め込みモデル
- **チャンクサイズ**: 基本512トークン、長いドキュメントはオーバーラップありで分割

### 3.2 埋め込み対象
- ドキュメントの各セクション
- ノートの段落
- チャットの質問と回答
- 図表のキャプションと説明文

### 3.3 埋め込みプロセス
1. コンテンツを適切なサイズのチャンクに分割
2. 各チャンクをベクトル化
3. メタデータと共にベクトルデータベースに保存
4. 定期的な再埋め込み（モデル更新時など）

## 4. 検索プロセス

### 4.1 クエリ処理
1. ユーザークエリを同じ埋め込みモデルでベクトル化
2. ベクトルデータベースで類似ベクトル検索
3. 類似度スコアに基づき結果をランキング
4. ハイブリッド検索（キーワード検索と併用）の場合はスコアを統合

### 4.2 検索パラメータ
- **類似度閾値**: 最小類似度スコア（デフォルト0.75）
- **結果数**: 返却する最大結果数（デフォルト10件）
- **多様性パラメータ**: 結果の多様性を調整（MMR: Maximal Marginal Relevance）

## 5. 主要機能

### 5.1 類似コンテンツ検索
- ドキュメントセクションから類似セクションを検索
- 「この内容と似ているものを探す」機能

### 5.2 自然言語質問
- 質問文から関連するコンテンツを検索
- 「〜について説明しているセクションはどこですか？」のような問いかけ

### 5.3 概念検索
- 特定の概念や専門用語に関連するすべてのコンテンツを検索
- 「量子エンタングルメント関連のすべての内容」のような概念ベース検索

### 5.4 クロスリンガル検索
- 日英など異なる言語間での検索
- 日本語の質問で英語のコンテンツも検索可能

## 6. UI/UX

### 6.1 検索インターフェース
- 通常の検索ボックスと同じ入力フォーム
- 「意味検索モード」の切り替えボタン
- 長文入力に対応した拡張可能な検索ボックス

### 6.2 結果表示
- 類似度スコアの視覚的表示
- マッチした理由の説明（「〜の概念が類似」など）
- コンテキストを含むスニペット表示

## 7. パフォーマンス要件

- 検索応答時間: 1秒以内（95パーセンタイル）
- ベクトルDB容量: 原文書の約1.5倍
- クエリ並列処理: 最大10同時クエリ

## 8. 利用技術

- **ベクトルデータベース**: Pinecone または Qdrant
- **埋め込みモデル**: OpenAI Ada 002 または同等モデル
- **ハイブリッド検索**: Elasticsearchとの統合

## 9. APIエンドポイント

主要なAPIエンドポイントは[検索API仕様書](../../05_API仕様/04_APIリファレンス詳細/05_検索API.md)の「意味検索」セクションを参照してください。

## 10. 関連機能

- [全文検索](./02_全文検索.md)
- [ナビゲーション機能](./04_ナビゲーション機能.md)
