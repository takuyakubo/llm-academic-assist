# 学習ノート生成機能仕様

## 概要

学習ノート生成機能は、アップロードされた学術文書の内容に基づいて、構造化された学習用のノートを自動生成する機能です。この機能はLLM（大規模言語モデル）を活用し、文書の重要ポイント抽出、概念説明、要約などを行い、ユーザーの学習をサポートします。

## 目的

- 学術文書の理解を深めるための構造化されたノートを自動生成する
- ユーザーの理解度に合わせたカスタマイズ可能なノート形式を提供する
- 学習過程で重要な概念、用語、数式などを整理し、参照しやすくする
- 復習や参照のためのナレッジベースを構築する

## 機能詳細

### 1. ノート生成基本機能

#### 1.1 自動ノート生成

| 項目 | 説明 |
|------|------|
| 機能ID | NG-001 |
| 機能名 | 自動ノート生成 |
| 説明 | 選択した文書またはセクションから学習ノートを自動生成する |
| 入力情報 | - 文書ID/セクションID<br>- ノートタイプ（概要/詳細/質問回答形式）<br>- 難易度レベル（初級/中級/上級） |
| 処理内容 | 1. 指定された文書/セクションのテキスト取得<br>2. LLMによるテキスト解析とノート構造の作成<br>3. LLMによるノート内容の生成<br>4. 数式や図表の参照情報の処理<br>5. マークダウン形式での出力生成 |
| 出力情報 | 構造化されたマークダウン形式のノート |
| 画面構成 | - 文書/セクション選択UI<br>- ノート設定パネル<br>- プレビュー/エディタ領域 |
| 特記事項 | 生成したノートは編集可能な状態で提供される |

#### 1.2 ノートテンプレート

| 項目 | 説明 |
|------|------|
| 機能ID | NG-002 |
| 機能名 | ノートテンプレート |
| 説明 | ノート生成時に使用するテンプレートを管理する |
| 入力情報 | - テンプレート名<br>- テンプレート内容（マークダウン形式）<br>- 適用対象（文書タイプ、分野など） |
| 処理内容 | 1. テンプレート内容の検証<br>2. テンプレートの保存/更新<br>3. 既存ノートへの適用（オプション） |
| 出力情報 | テンプレート保存確認 |
| 画面構成 | - テンプレート一覧<br>- テンプレートエディタ<br>- テンプレート適用設定 |
| 特記事項 | システム提供の基本テンプレートとユーザー定義テンプレートをサポート |

#### 1.3 ノート編集

| 項目 | 説明 |
|------|------|
| 機能ID | NG-003 |
| 機能名 | ノート編集 |
| 説明 | 生成されたノートを編集・カスタマイズする |
| 入力情報 | - ノートID<br>- 編集内容 |
| 処理内容 | 1. ノートデータの取得<br>2. ユーザー編集内容の反映<br>3. 数式のレンダリング処理<br>4. 変更履歴の記録 |
| 出力情報 | 更新されたノート内容 |
| 画面構成 | - リッチテキストエディタ（マークダウン対応）<br>- 数式エディタ<br>- ツールバー（見出し設定、リスト作成、表作成など） |
| 特記事項 | マークダウンの直接編集モードとWYSIWYGモードを切り替え可能 |

### 2. ノート構造最適化

#### 2.1 構造化ノート生成

| 項目 | 説明 |
|------|------|
| 機能ID | NG-004 |
| 機能名 | 構造化ノート生成 |
| 説明 | 文書構造に基づいた階層的なノートを生成する |
| 入力情報 | - 文書ID<br>- 構造化レベル（章/節/項）<br>- 含めるセクション（選択式） |
| 処理内容 | 1. 文書構造の解析<br>2. 選択されたセクションの内容取得<br>3. 各セクションのノート生成<br>4. 階層構造の構築<br>5. 相互参照リンクの生成 |
| 出力情報 | 階層構造を持つノート |
| 画面構成 | - 文書構造ツリービュー<br>- セクション選択UI<br>- プレビュー領域（階層表示） |
| 特記事項 | 目次自動生成と内部リンク機能を含む |

#### 2.2 概念マップ生成

| 項目 | 説明 |
|------|------|
| 機能ID | NG-005 |
| 機能名 | 概念マップ生成 |
| 説明 | 文書内の主要概念とその関係性を視覚化した概念マップを生成する |
| 入力情報 | - 文書ID/ノートID<br>- 詳細度レベル |
| 処理内容 | 1. 文書/ノートからの主要概念抽出<br>2. 概念間の関係性分析<br>3. 概念マップの構造生成<br>4. 視覚的表現の生成 |
| 出力情報 | インタラクティブな概念マップ（Markdown + Mermaid） |
| 画面構成 | - 概念マップ表示領域<br>- ズーム/パン操作UI<br>- 詳細度調整スライダー |
| 特記事項 | マップの各ノードはノート内の関連セクションへのリンクを持つ |

### 3. 内容拡充機能

#### 3.1 概念説明の自動拡充

| 項目 | 説明 |
|------|------|
| 機能ID | NG-006 |
| 機能名 | 概念説明の自動拡充 |
| 説明 | ノート内の特定の概念や用語に対する詳細な説明を自動生成する |
| 入力情報 | - ノートID<br>- 対象概念/用語<br>- 詳細度レベル |
| 処理内容 | 1. 対象概念の特定<br>2. 関連コンテキストの収集<br>3. LLMによる説明生成<br>4. 既存ノートへの統合 |
| 出力情報 | 拡充された説明を含むノート |
| 画面構成 | - 概念選択UI（ハイライトまたはリスト）<br>- 詳細度設定<br>- プレビュー/編集領域 |
| 特記事項 | 自動生成と手動トリガーの両方のモードをサポート |

#### 3.2 例題・練習問題生成

| 項目 | 説明 |
|------|------|
| 機能ID | NG-007 |
| 機能名 | 例題・練習問題生成 |
| 説明 | ノートの内容に基づいた例題や練習問題を自動生成する |
| 入力情報 | - ノートID<br>- 問題タイプ（記述式/選択式/True-False）<br>- 難易度<br>- 問題数 |
| 処理内容 | 1. ノート内容の分析<br>2. 重要概念・原理の特定<br>3. LLMによる問題生成<br>4. 解答・解説の生成 |
| 出力情報 | 問題と解答・解説のセット |
| 画面構成 | - 問題設定パネル<br>- 生成された問題一覧<br>- 問題編集・カスタマイズUI |
| 特記事項 | 数式を含む問題もサポート |

#### 3.3 参考資料リンク

| 項目 | 説明 |
|------|------|
| 機能ID | NG-008 |
| 機能名 | 参考資料リンク |
| 説明 | ノート内容に関連する外部参考資料へのリンクを提案・追加する |
| 入力情報 | - ノートID<br>- リンクタイプ（学術論文/教科書/オンラインリソース）<br>- 自動/手動選択 |
| 処理内容 | 1. ノート内容の分析<br>2. 関連キーワード抽出<br>3. 関連資料の検索・提案<br>4. リンクの追加 |
| 出力情報 | 参考資料リンクリスト |
| 画面構成 | - 提案リンク一覧<br>- リンク追加フォーム<br>- リンク管理セクション |
| 特記事項 | ノート内の該当箇所への自動アノテーションも可能 |

### 4. 復習・学習支援機能

#### 4.1 復習ノート生成

| 項目 | 説明 |
|------|------|
| 機能ID | NG-009 |
| 機能名 | 復習ノート生成 |
| 説明 | 既存ノートから復習用の簡潔なノートを自動生成する |
| 入力情報 | - ノートID/複数ノートID<br>- 復習レベル（簡易/標準/詳細）<br>- フォーカス領域（任意） |
| 処理内容 | 1. 元ノートからの重要ポイント抽出<br>2. ポイントの再構成・要約<br>3. 核となる概念・原理の強調<br>4. 復習クイズの生成（オプション） |
| 出力情報 | 復習用ノート |
| 画面構成 | - 元ノート選択<br>- 復習オプション設定<br>- プレビュー/エディタ |
| 特記事項 | 復習スケジュールへの組み込みが可能 |

#### 4.2 フラッシュカード生成

| 項目 | 説明 |
|------|------|
| 機能ID | NG-010 |
| 機能名 | フラッシュカード生成 |
| 説明 | ノートからフラッシュカードを自動生成する |
| 入力情報 | - ノートID<br>- カードタイプ（概念定義/数式/問題）<br>- 生成量 |
| 処理内容 | 1. ノートからのキーポイント抽出<br>2. 質問と回答ペアの生成<br>3. フラッシュカードセットの作成 |
| 出力情報 | フラッシュカードセット |
| 画面構成 | - カード生成設定<br>- カードプレビュー<br>- カード編集インターフェース<br>- 学習インターフェース |
| 特記事項 | 間隔反復学習システムへのエクスポート機能を含む |

### 5. ノート管理機能

#### 5.1 ノート整理・分類

| 項目 | 説明 |
|------|------|
| 機能ID | NG-011 |
| 機能名 | ノート整理・分類 |
| 説明 | 生成されたノートを整理・分類する |
| 入力情報 | - ノートID<br>- タグ/カテゴリ<br>- 優先度/重要度 |
| 処理内容 | 1. メタデータ更新<br>2. タグ付け<br>3. カテゴリ分類<br>4. 優先度設定 |
| 出力情報 | 更新されたノートメタデータ |
| 画面構成 | - ノート一覧（フィルタリング/ソート機能付き）<br>- タグ管理<br>- カテゴリ管理 |
| 特記事項 | ドラッグ＆ドロップでの整理をサポート |

#### 5.2 ノート検索・フィルタリング

| 項目 | 説明 |
|------|------|
| 機能ID | NG-012 |
| 機能名 | ノート検索・フィルタリング |
| 説明 | 保存されたノートを検索・フィルタリングする |
| 入力情報 | - 検索キーワード<br>- フィルター条件（日付/タグ/カテゴリ）<br>- ソート条件 |
| 処理内容 | 1. 全文検索<br>2. フィルター条件の適用<br>3. 結果のソート<br>4. 検索結果のハイライト |
| 出力情報 | 検索結果一覧 |
| 画面構成 | - 検索バー<br>- フィルター/ソートオプション<br>- 検索結果表示領域 |
| 特記事項 | 数式や特殊記号を含む検索もサポート |

#### 5.3 ノートエクスポート・共有

| 項目 | 説明 |
|------|------|
| 機能ID | NG-013 |
| 機能名 | ノートエクスポート・共有 |
| 説明 | 生成・編集したノートをエクスポート・共有する |
| 入力情報 | - ノートID<br>- エクスポート形式（PDF/Markdown/HTML）<br>- 共有設定 |
| 処理内容 | 1. 選択形式へのフォーマット変換<br>2. 数式・図表の適切な変換<br>3. エクスポートファイル生成<br>4. 共有リンク/権限設定（共有時） |
| 出力情報 | エクスポートファイルまたは共有リンク |
| 画面構成 | - エクスポート設定<br>- 共有設定<br>- ダウンロード/共有リンク |
| 特記事項 | エクスポート時にスタイル設定を適用可能 |

## UI設計

### ノート生成画面

ノート生成画面では、ユーザーがドキュメントを選択し、ノートの生成オプションを設定できます。

![ノート生成画面](../../../images/note_generation.png)

#### 主要コンポーネント
- 文書選択パネル: 対象文書またはセクションを選択
- 生成オプションパネル:
  - ノートタイプ選択（概要/詳細/Q&A形式）
  - 難易度レベル設定
  - テンプレート選択
  - 追加オプション（例題含む/概念マップ含むなど）
- プレビュー領域: 生成されるノートのプレビュー
- アクションボタン: 生成開始、キャンセル、保存

### ノートエディタ画面

ノートエディタ画面では、生成されたノートの編集や拡充を行います。

![ノートエディタ画面](../../../images/note_editor.png)

#### 主要コンポーネント
- ツールバー: テキスト書式設定、リスト作成、表作成などの機能
- 数式エディタ: LaTeX形式の数式入力と表示
- エディタ領域: ノート本文の編集領域（マークダウン対応）
- サイドパネル:
  - 目次（自動生成）
  - 関連概念リスト
  - 参考資料リンク
- アクションボタン: 保存、エクスポート、共有、プレビュー

### ノート一覧・管理画面

ノート一覧・管理画面では、作成したノートの閲覧、整理、検索を行います。

![ノート管理画面](../../../images/note_management.png)

#### 主要コンポーネント
- 検索バー: キーワード検索
- フィルターパネル: 日付、タグ、カテゴリなどによるフィルタリング
- ノートリスト: ノート一覧（カード表示またはリスト表示）
- ソートオプション: 作成日、更新日、名前などによるソート
- アクションメニュー: 各ノートに対する操作（編集、削除、共有など）

## データモデル

### ノートモデル

```json
{
  "_id": "ObjectId",
  "title": "String",
  "content": "String (Markdown)",
  "sourceDocumentId": "ObjectId(Document)",
  "sourceIds": ["ObjectId(DocumentSection)"],
  "projectId": "ObjectId(Project)",
  "authorId": "ObjectId(User)",
  "type": "String (enum: summary, detailed, qa, flashcard)",
  "difficultyLevel": "String (enum: beginner, intermediate, advanced)",
  "createdAt": "Date",
  "updatedAt": "Date",
  "isDeleted": "Boolean",
  "tags": ["String"],
  "category": "String",
  "metadata": {
    "wordCount": "Number",
    "readingTime": "Number",
    "hasExercises": "Boolean",
    "hasMathEquations": "Boolean",
    "hasConceptMap": "Boolean",
    "customFields": {}
  },
  "version": "Number",
  "versionHistory": [
    {
      "version": "Number",
      "content": "String",
      "updatedAt": "Date",
      "updatedBy": "ObjectId(User)"
    }
  ]
}
```

### ノートテンプレートモデル

```json
{
  "_id": "ObjectId",
  "name": "String",
  "description": "String",
  "content": "String (Markdown with placeholders)",
  "createdBy": "ObjectId(User)",
  "isSystem": "Boolean",
  "documentTypes": ["String"],
  "subjectAreas": ["String"],
  "createdAt": "Date",
  "updatedAt": "Date",
  "isDeleted": "Boolean"
}
```

### フラッシュカードモデル

```json
{
  "_id": "ObjectId",
  "noteId": "ObjectId(Note)",
  "cards": [
    {
      "front": "String (Markdown)",
      "back": "String (Markdown)",
      "tags": ["String"],
      "type": "String (enum: concept, equation, problem)"
    }
  ],
  "authorId": "ObjectId(User)",
  "createdAt": "Date",
  "updatedAt": "Date",
  "lastStudiedAt": "Date",
  "studyMetrics": {
    "totalReviews": "Number",
    "correctResponses": "Number",
    "incorrectResponses": "Number"
  }
}
```

## APIインターフェース

### ノート生成・管理API

#### ノート生成 API

```
POST /api/notes/generate
```

リクエスト:
```json
{
  "sourceDocumentId": "60a1c2e3d4e5f6a7b8c9d0e1",
  "sourceIds": ["section_1", "section_2"],
  "type": "detailed",
  "difficultyLevel": "intermediate",
  "templateId": "70a1c2e3d4e5f6a7b8c9d0e1",
  "options": {
    "includeExercises": true,
    "includeConceptMap": true
  }
}
```

レスポンス:
```json
{
  "success": true,
  "data": {
    "id": "80a1c2e3d4e5f6a7b8c9d0e1",
    "title": "量子力学の基本原理",
    "content": "# 量子力学の基本原理\n\n## 1. 波動関数\n\n波動関数 $\\Psi(x,t)$ は粒子の状態を表し...",
    "type": "detailed",
    "difficultyLevel": "intermediate",
    "createdAt": "2023-12-01T12:00:00Z"
  }
}
```

#### ノート更新 API

```
PUT /api/notes/{noteId}
```

#### ノート検索 API

```
GET /api/notes/search?query=量子力学&tags=重要&category=物理学
```

### テンプレート管理API

#### テンプレート作成 API

```
POST /api/templates
```

#### テンプレート適用 API

```
POST /api/notes/{noteId}/apply-template
```

### 補足コンテンツ生成API

#### 概念マップ生成 API

```
POST /api/notes/{noteId}/concept-map
```

#### 練習問題生成 API

```
POST /api/notes/{noteId}/exercises
```

## LLMプロンプト設計

### ノート生成プロンプト

```
あなたは学術ノート生成アシスタントです。以下の学術文書の内容に基づいて、構造化された学習ノートを生成してください。

文書タイトル: {title}
対象セクション: {sections}
ノートタイプ: {type} (詳細 / 概要 / Q&A形式)
難易度レベル: {level} (初級 / 中級 / 上級)

ノートは以下の要素を含めてください:
1. セクションの主要な概念と原理の説明
2. 重要な定義と数式（LaTeX形式）
3. 概念間の関連性
4. {追加オプションに基づく要素}

出力形式はマークダウンとし、適切な見出しレベルと構造を維持してください。LaTeX数式は $...$ (インライン) または $$...$$ (ディスプレイモード) で記述してください。

文書内容:
{content}
```

### 概念マップ生成プロンプト

```
以下のノート内容に基づいて、主要な概念とその関係性を示す概念マップを生成してください。出力はMermaid形式のフローチャートとしてください。

重要な概念を抽出し、以下の関係タイプを使って接続してください:
- 包含関係（AはBを含む）
- 派生関係（AはBから派生）
- 対比関係（AとBは対比される）
- 応用関係（AはBに応用される）

ノート内容:
{content}
```

### 練習問題生成プロンプト

```
以下のノート内容に基づいて、学習者の理解度を確認するための練習問題を{count}問生成してください。

難易度: {level}
問題タイプ: {type} (記述式 / 選択式 / True-False)

各問題には以下の要素を含めてください:
1. 問題文
2. (選択式の場合) 選択肢
3. 正解
4. 詳細な解説

問題は、ノートの主要概念、原理、応用に焦点を当て、単なる暗記ではなく理解度を測るものにしてください。

ノート内容:
{content}
```

## 実装上の注意点

1. **LLMの制約**:
   - 長文処理の制限に対応するため、文書を適切にチャンクに分割
   - 処理タイムアウトを考慮した非同期処理の実装
   - LLMのコスト最適化（キャッシュ、モデル選択）

2. **数式処理**:
   - LaTeX数式の正確なレンダリング
   - 数式エディタの使いやすさと機能性のバランス
   - 複雑な数式のモバイル対応

3. **ノート構造の一貫性**:
   - 生成されるノートの構造が一貫していることを確保
   - テンプレートの適切な適用
   - ユーザー編集とLLM生成内容の統合

4. **パフォーマンス最適化**:
   - 大量のノートデータの効率的な処理と表示
   - リアルタイムプレビューのレンダリング最適化
   - 検索とフィルタリングのインデックス設計

## 将来拡張予定の機能

- **協調ノート作成**: 複数ユーザーによる同時編集機能
- **音声ノート**: 音声入力からのノート生成と音声出力
- **インタラクティブ学習モジュール**: ノート内容に基づく対話型学習コンテンツ
- **カスタムAI学習**: ユーザーの学習スタイルに適応するAIパーソナライゼーション
- **外部ツール連携**: Anki、Notion、Obsidian などへのエクスポート機能の拡充
